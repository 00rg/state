metrics:
    configs:
        - name: grafana-stack/default-metrics-instance
          remote_write:
            - url: http://prometheus-operated:9090/api/v1/write
          scrape_configs:
            - honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-prometheus/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              metrics_path: /metrics
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: "true"
                  source_labels:
                    - __meta_kubernetes_service_label_self_monitor
                - action: keep
                  regex: http-web
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: http-web
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: false
              job_name: serviceMonitor/default/tempo/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: tempo
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: Helm
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_managed_by
                - action: keep
                  regex: tempo
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: 1.5.0
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_version
                - action: keep
                  regex: tempo-0.16.9
                  source_labels:
                    - __meta_kubernetes_service_label_helm_sh_chart
                - action: keep
                  regex: tempo-prom-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: tempo-prom-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: false
              job_name: serviceMonitor/default/tempo/1
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: tempo
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: Helm
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_managed_by
                - action: keep
                  regex: tempo
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: 1.5.0
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_version
                - action: keep
                  regex: tempo-0.16.9
                  source_labels:
                    - __meta_kubernetes_service_label_helm_sh_chart
                - action: keep
                  regex: jaeger-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: jaeger-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-alertmanager/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              metrics_path: /metrics
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-alertmanager
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: "true"
                  source_labels:
                    - __meta_kubernetes_service_label_self_monitor
                - action: keep
                  regex: http-web
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: http-web
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-state-metrics/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: kube-state-metrics
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: http
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                  target_label: job
                - replacement: http
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kube-proxy/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-kube-proxy
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kubelet/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                - action: keep
                  regex: https-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                  target_label: job
                - replacement: https-metrics
                  target_label: endpoint
                - action: replace
                  source_labels:
                    - __metrics_path__
                  target_label: metrics_path
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                insecure_skip_verify: true
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kubelet/1
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              metric_relabel_configs:
                - action: drop
                  regex: container_cpu_(cfs_throttled_seconds_total|load_average_10s|system_seconds_total|user_seconds_total)
                  source_labels:
                    - __name__
                - action: drop
                  regex: container_fs_(io_current|io_time_seconds_total|io_time_weighted_seconds_total|reads_merged_total|sector_reads_total|sector_writes_total|writes_merged_total)
                  source_labels:
                    - __name__
                - action: drop
                  regex: container_memory_(mapped_file|swap)
                  source_labels:
                    - __name__
                - action: drop
                  regex: container_(file_descriptors|tasks_state|threads_max)
                  source_labels:
                    - __name__
                - action: drop
                  regex: container_spec.*
                  source_labels:
                    - __name__
                - action: drop
                  regex: .+;
                  source_labels:
                    - id
                    - pod
              metrics_path: /metrics/cadvisor
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                - action: keep
                  regex: https-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                  target_label: job
                - replacement: https-metrics
                  target_label: endpoint
                - action: replace
                  source_labels:
                    - __metrics_path__
                  target_label: metrics_path
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                insecure_skip_verify: true
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kubelet/2
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              metrics_path: /metrics/probes
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: kubelet
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                - action: keep
                  regex: https-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_k8s_app
                  target_label: job
                - replacement: https-metrics
                  target_label: endpoint
                - action: replace
                  source_labels:
                    - __metrics_path__
                  target_label: metrics_path
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                insecure_skip_verify: true
            - honor_labels: false
              job_name: serviceMonitor/grafana-stack/grafana-agent/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              metrics_path: /metrics
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: "true"
                  source_labels:
                    - __meta_kubernetes_service_label_operated_agent
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-grafana/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              metrics_path: /metrics
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: grafana
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: http-web
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_kube_prometheus
                  target_label: job
                - replacement: http-web
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: http
              scrape_timeout: 30s
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-coredns/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-coredns
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - honor_labels: false
              job_name: serviceMonitor/grafana-stack/loki/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              metrics_path: /metrics
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: loki
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: loki
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: drop
                  regex: "false"
                  source_labels:
                    - __meta_kubernetes_service_label_prometheus_io_service_monitor
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: replace
                  replacement: grafana-stack/$1
                  source_labels:
                    - job
                  target_label: job
                - action: replace
                  replacement: loki
                  target_label: cluster
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: http
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-apiserver/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - default
                  role: endpoints
              metric_relabel_configs:
                - action: drop
                  regex: apiserver_request_duration_seconds_bucket;(0.15|0.2|0.3|0.35|0.4|0.45|0.6|0.7|0.8|0.9|1.25|1.5|1.75|2|3|3.5|4|4.5|6|7|8|9|15|25|40|50)
                  source_labels:
                    - __name__
                    - le
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: apiserver
                  source_labels:
                    - __meta_kubernetes_service_label_component
                - action: keep
                  regex: kubernetes
                  source_labels:
                    - __meta_kubernetes_service_label_provider
                - action: keep
                  regex: https
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_component
                  target_label: job
                - replacement: https
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                server_name: kubernetes
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kube-controller-manager/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-kube-controller-manager
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                insecure_skip_verify: true
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kube-etcd/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-kube-etcd
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
            - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
              honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-kube-scheduler/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - kube-system
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-kube-scheduler
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: https
              tls_config:
                ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
                insecure_skip_verify: true
            - honor_labels: false
              job_name: serviceMonitor/grafana-stack/kube-prometheus-prometheus-node-exporter/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_instance
                - action: keep
                  regex: prometheus-node-exporter
                  source_labels:
                    - __meta_kubernetes_service_label_app_kubernetes_io_name
                - action: keep
                  regex: http-metrics
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - regex: (.+)
                  replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_label_jobLabel
                  target_label: job
                - replacement: http-metrics
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
              scheme: http
            - honor_labels: true
              job_name: serviceMonitor/grafana-stack/kube-prometheus-kube-prome-operator/0
              kubernetes_sd_configs:
                - namespaces:
                    names:
                        - grafana-stack
                  role: endpoints
              relabel_configs:
                - source_labels:
                    - job
                  target_label: __tmp_prometheus_job_name
                - action: keep
                  regex: kube-prometheus-stack-operator
                  source_labels:
                    - __meta_kubernetes_service_label_app
                - action: keep
                  regex: kube-prometheus
                  source_labels:
                    - __meta_kubernetes_service_label_release
                - action: keep
                  regex: http
                  source_labels:
                    - __meta_kubernetes_endpoint_port_name
                - regex: Node;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: node
                - regex: Pod;(.*)
                  replacement: $1
                  separator: ;
                  source_labels:
                    - __meta_kubernetes_endpoint_address_target_kind
                    - __meta_kubernetes_endpoint_address_target_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_namespace
                  target_label: namespace
                - source_labels:
                    - __meta_kubernetes_service_name
                  target_label: service
                - source_labels:
                    - __meta_kubernetes_pod_name
                  target_label: pod
                - source_labels:
                    - __meta_kubernetes_pod_container_name
                  target_label: container
                - replacement: $1
                  source_labels:
                    - __meta_kubernetes_service_name
                  target_label: job
                - replacement: http
                  target_label: endpoint
                - action: hashmod
                  modulus: 1
                  source_labels:
                    - __address__
                  target_label: __tmp_hash
                - action: keep
                  regex: $(SHARD)
                  source_labels:
                    - __tmp_hash
    global:
        external_labels:
            __replica__: replica-$(STATEFULSET_ORDINAL_NUMBER)
            cluster: grafana-stack/default-grafana-agent
    wal_directory: /var/lib/grafana-agent/data
server:
    log_level: info


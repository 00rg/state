namespaceOverride: grafana-stack

prometheusOperator:
  # This reuses the secret generated by kube-webhook-certgen below (that we've disabled). If
  # we don't also disable TLS here then the prometheus-operator pod will fail to start since
  # that secret won't exist.
  tls:
    enabled: false
  admissionWebhooks:
    # When enabled, the kube-webhook-certgen project is used to generate a self-signed cert
    # into a Kubernetes secret and then patch the admission controller configuration so that
    # it uses the cert. The problem is that all published image versions of kube-webhook-certgen
    # use the v1beta1 API group of MutatingWebhookConfiguration rather than v1 which is now
    # standard. So disabling for now and will replace with cert-manager later.
    enabled: false

prometheus:
  prometheusSpec:
    externalUrl: http://office.00rg.com:8082/prometheus
    enableRemoteWriteReceiver: true
    # By default, don't use the prometheus-operator to manage ServiceMonitors, PodMonitors or
    # Probes as we'll use grafana-agent-operator to manage these instead.
    serviceMonitorSelector:
      matchLabels:
        reconcile-with-prometheus-operator: "true"
    podMonitorSelector:
      matchLabels:
        reconcile-with-prometheus-operator: "true"
    probeSelector:
      matchLabels:
        reconcile-with-prometheus-operator: "true"

alertmanager:
  # Note: to manage the Alertmanager config properly as a secret you need to use the
  # alertmanagerSpec field to map in the config as a volume rather than it being specified
  # verbatim in the config field. Could probably use a standard Kubernetes secret or the
  # Secret Store CSI Driver and different secret backends depending on whether you're on
  # the cloud (e.g. https://github.com/aws/secrets-store-csi-driver-provider-aws) or running
  # locally (e.g. https://github.com/hashicorp/vault-csi-provider). Would be ideal to be able
  # to specify the non-secret parts of the config as raw YAML in this repo (see
  # https://github.com/machinezone/configmapsecrets).
  alertmanagerSpec:
    externalUrl: http://office.00rg.com:8082/alertmanager
  config:
    global:
      resolve_timeout: 5m
    route:
      group_by: ['job']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      routes:
      - match:
          alertname: InstanceLowMemory
          severity: critical
        receiver: "null"
      - match:
        receiver: pagerduty
        continue: true
    receivers:
    - name: "null"
    - name: pagerduty

grafana:
  namespaceOverride: grafana-stack
  # Disable the Grafana chart tests as because we're not using Helm to do the deployment the
  # tests will start running immediately and then fail.
  testFramework:
    enabled: false
  grafana.ini:
    server:
      root_url: http://office.00rg.com:8082/grafana
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: Loki
        type: loki
        url: http://loki:3100

  dashboardProviders:
   dashboardproviders.yaml:
     apiVersion: 1
     providers:
     - name: default
       type: file
       disableDeletion: true
       editable: false
       options:
         path: /var/lib/grafana/dashboards/default

  dashboards:
    default:
      # Istio Control Plane Dashboard for Istio 1.16.1
      istio-control-plane-dashboard:
        gnetId: 7645
        revision: 146
        datasource: Prometheus
      # Istio Mesh Dashboard for Istio 1.16.1
      istio-mesh-dashboard:
        gnetId: 7639
        revision: 146
        datasource: Prometheus
      # Istio Service Dashboard for Istio 1.16.1
      istio-service-dashboard:
        gnetId: 7636
        revision: 146
        datasource: Prometheus
      # Istio Workload Dashboard for Istio 1.16.1
      istio-workload-dashboard:
        gnetId: 7630
        revision: 146
        datasource: Prometheus
      # Istio Performance Dashboard for Istio 1.16.1
      istio-performance-dashboard:
        gnetId: 11829
        revision: 146
        datasource: Prometheus
      # Istio WASM Extension Dashboard for Istio 1.16.1
      istio-wasm-dashboard:
        gnetId: 13277
        revision: 103
        datasource: Prometheus

kube-state-metrics:
  namespaceOverride: grafana-stack

prometheus-node-exporter:
  namespaceOverride: grafana-stack
